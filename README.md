
# MC9S12微控制器

## 考试原题
### 简述MC9S12XS系列单片机中的SRAM是怎么组织的，以及MC9S12XS128的具体情况
> - MC9S12XS系列单片机中的SRAM是通过一组地址线和数据线与CPU相连的。
> - 以MC9S12XS128为例，它有16KB的SRAM，被组织成了4个独立的8位页。每个页的大小为4KB。这些页的地址可以通过地址线进行访问。在MC9S12XS128中，页的地址是从0x0080到0x00FF的范围内，每个页的地址范围为0x0400。因此，MC9S12XS128的SRAM可以被看作是4个4KB大小的存储块。



### 选择/填空
> - RS-232 的定义接口TXD是**数据传输线**,RXD是**数据接收线**,GND是**信号地*.***
> - 利用监控程序查看MC9S12XS128的全部寄存器使用的指令是**MONITOR**,显示内存数据指令**D**。
> - C程序中导出符号定义的保留字是**EXTERN**,导入符号定义的保留字是**???**.
> - 在S12的集成开发环境中，时可以使用初始变量的。
> - PPAGE不属于S12单片机的CPU寄存器

### 跑马灯
    void main(void) 
    {    unsigned char flag;        //定义变量，记录点亮LED序号
        DDRB = 0XFF;          //定义PORTB端口为输出口
        flag = 0;                //变量初始化，程序起始点亮灯D0
        for(;;) {
           switch (flag) 
           {
            case 0: PORTB = 0xFE; break;
            case 1: PORTB = 0xFD; break;
            case 2: PORTB = 0xFB; break;
            case 3: PORTB = 0xF7; break;
            case 4: PORTB = 0xEF; break;
            case 5: PORTB = 0xDF; break;
            case 6: PORTB = 0xBF; break;
            case 7: PORTB = 0x7F; break;
           }
           flag ++;
           if(flag == 8)
               flag =0;
           wait();        
        } 
    }
  ***
  ***
  ***
 ## 高优先级
 
 ### MC9S12X单片机的page寄存器
> - PPAGE寄存器  
> - RPAGE寄存器  
> - EPAGE寄存器  
> - GPAGE寄存器  

### 操作指令

> - H命令：显示各种命令信息；
> - D命令：显示一段内存的内容；
> - M命令：用来改变RAM内存中的内容；
> - L命令：下载程序到Flash中（可识别S1和S2格式的S19文件）；
> - E命令：用来擦除内部64KB寻址空间范围内的（0x4000-0x7FFF）和（0xC000-0xEFFF）区域；
> - G命令：用来从PC寄存器的地址处，开始运行程序;
> - Ctrl+P命令:修改PC指针;
> - Ctrl+A命令:用于改变寄存器A的值；（B,X,Y的值使用类似命令修改）；
> - R命令：用来显示所有CPU寄存器的内容；
> - Q命令：用来擦除指定页页的Flash。

### 跳转指令
> - CCR
> - SP
> - PC
> - JMP

## 跳转指令
> - CCR
> - SP
> - PC
> - JMP

## 汇编语言
> 导入符号 EXTERN/IMPORT？[sir，this way](https://www.cnblogs.com/prayer521/p/5894106.html)   
> 导出符号 PUBLIC/EXPORT？   
> 子程序返回指令RTC RTS  
> 中断服务程序最后一条指令返回 RTI



### S12XS CPU内部寄存器结构
> 1．两个可分别使用的8位累加器A和B共同组成16位累加器D<BR>
> 2．一个16位的变址寄存器X<BR>
> 3．一个16位的变址寄存器Y<BR>
> 4．一个16位的堆栈指针SP<BR>
> 5．一个16位的程序计数器PC<BR>
> 6．一个16位的条件码寄存器CCR<BR>

### 中断的基本功能
> 1. 能实现中断响应，中断处理，中断返回，中断屏蔽。  
> 2. 能实现中断优先级排队（管理）。  
> 3. 能实现中断嵌套。  
> 4. CCR寄存器最后入栈
> 5. 中断服务的最后一条指令是RTI
> 6. 中断服务程序只能定位在内容内存中

###  复位操作
> - 上电复位
> - 低电压复位 
> - 外部复位
> - 时钟故障
> - 看门狗复位
> - 非法地址复位

## 操作指令

> - H命令：显示各种命令信息；
> - D命令：显示一段内存的内容；
> - M命令：用来改变RAM内存中的内容；
> - L命令：下载程序到Flash中（可识别S1和S2格式的S19文件）；
> - E命令：用来擦除内部64KB寻址空间范围内的（0x4000-0x7FFF）和（0xC000-0xEFFF）区域；
> - G命令：用来从PC寄存器的地址处，开始运行程序;
> - Ctrl+P命令:修改PC指针;
> - Ctrl+A命令:用于改变寄存器A的值；（B,X,Y的值使用类似命令修改）；
> - R命令：用来显示所有CPU寄存器的内容；
> - Q命令：用来擦除指定页页的Flash。

## CPU12XS的中断过程
> 中断过程可以分为四步,分别是中断请求、中断响应、中断服务和中断返回。当中断源要CPU为其服务时,先发出一个中断请求信号,CPU不断查询中断请求标志,一旦查询到某个中断请求标志置位,则根据中断响应条件去响应请求,从而转去执行中断服务程序。但转去中断程序时,要求先保护现场,将相关的在服务子程序可能改变的存储单元内容压入堆栈保护,然后再去执行中断服务程序主体,最后中断返回,再返回前将原先的堆栈内容出栈,即恢复现场。


## C程序中的全局变量，常量，一般函数，中断函数在寄存器中的存储位置
> 1. 全局变量：全局变量通常会分配在静态数据段（.data）或者零初始化数据段（.bss）中。
> 2. 常量：常量通常会分配在只读数据段（.const）中。
> 3. 一般函数通常会分配在代码段（.text）中。
> 4. 中断函数通常会分配在中断向量表中。

## C程序参数传递规则与返回值传递规则
> 1. 参数传递规则：  
> - 通常情况下，函数参数会按照从右往左的顺序依次压入堆栈中。
> - 对于小于等于4个字节的参数，可以直接传递到CPU寄存器中，不需要使用堆栈。
> - 对于结构体或数组等较大的参数，通常采用指针传递的方式，即传递参数的地址，而不是实际的数据。
> 2. 返回值传递规则:
> - 对于基本类型的返回值（如int、float等），通常使用CPU寄存器进行返回。
> - 对于较大的结构体或数组等返回值，通常采用指针传递的方式，即返回值的地址，而不是实际的数据。

***
***
***
## 其他
### 命名规则
| MC  | 9   | S12 | DG  |  128B | x | xx | E |  
| --- | --- | --- | --- | --- | --- | --- | --- |  
| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |

> 1: MC 表示合格产品 XC表示初始产品 PC表示预测试产品  
> 2: 表示存储器类型。无表示片内带ROM或者片内没有程序存储器，7表示片内带EPROM或一次可编程ROM（OTP ROM），8表示片内带EEPROM，9表示片内带Flash存储器。  
> 3: 表示内核类型。S12表示16位单片机，S08表示8位单片机。  
> 4:  表示系列。DG表示为D系列产品  
> 5:  表示存储空间大小及版本。128表示128 KB的Flash存储空间，B为Flash版本。
> 6: 表示工作温度范围。无表示工作温度范围是0℃～70℃，C表示工作温度范围是-40℃～85℃，V表示工作温度范围是-40℃～105℃，M表示工作温度范围是-40℃～125℃。
> 7: 表示封装形式。FU表示80引脚QFP封装，PV表示112引脚LQFP封装。
> 8: 表示无铅标志。E表示芯片生产过程无铅


### S12XS系列MCU的存储器
| 0X0000 - 0X07FF | 0X0800 - 0X0FFF|0X1000 - 0X3FFF|0X4000-0XFFFF|  
|---|---|---|---|
|2kb I/O寄存器|2kb EEPROM |12kb RAM |48kb Flash|  

# 监控程序
## 什么是监控程序
> 监控程序也称Bootloader是事先固化在芯片内部Flash中的一段程序，它是底层硬件和上层软件之间的一个中间接口软件。监控程序启动后首先完成处理器和周边电路的初始化，之后，等待从来自操作人员从人机交互接口发送过来的基本命令并执行基本命令，基本命令包括擦除FLASH和下载程序、运行和停止程序、监视和控制系统资源。
## 工作原理与具体功能
### 工作原理： 
> 监控程序通过对系统的软硬件资源进行监视和控制达到对系统软硬件进行调试的目的。  

### 监控程序具体功能：  
> 1.实现人机交互  
> 2.使用户可以查看单片机内的各种资源，包括寄存器、存储器；  
> 3.使用户可以修改单片机内的各种资源，包括寄存器、存储器；  
> 4.用户可以向单片机系统内存中装载程序；  
> 5.用户可以从内存任意地址开始执行程序。  
> 6.能在被调试程序中设置断点，观察程序执行过程。  


## XS128 MCU复位的执行过程
> &nbsp;&nbsp; 系统上电后，单片机首先进行CPU复位（所有I/O口默认为输入端，CCR寄存器中：XIRQ(外部非屏蔽中断位) = 1，I（可屏蔽中断允许位） = 1,所有I/O模块的中断请求也都是禁止的）。    
&nbsp;&nbsp;CPU在复位后读取0Xfffe:0xffff单元中的内容，并以该内容为起始地址执行程序，即执行0Xfffe:0xffff单元指向的程序。这个地址也叫复位向量。


## MC9S12X寻址方式
> -    隐含/固有寻址（Inherent Addressing，INH）：有效地址包含在操作码中，又因为操作数总是处在MCU的寄存器中，所以也称为寄存器寻址。
> -  立即寻址（Immediate Addressing，IMM）：若指令的操作数是一个8位或16位二进制数，则称为立即寻址。为与直接寻址区别，立即数前必须加“#”号。
> -    直接寻址（Direct Addressing，DIR）：指令中直接给出操作数地址的寻址方式称为    直接寻址。由于直接寻址的范围是$00-$FF,所以有时也称为0页寻址或首页寻址。存储空间的这个区域传统上称为直接页。
> -   扩展寻址（Extended Addressing， EXT）：指令中直接给出操作数16位地址的寻址方式（与直接寻址相比较去理解）。扩展寻址与直接寻址都属于绝对寻址。当采用绝对寻址时，有效地址紧随在操作码之后。在扩展寻址中，指令给出了16位有效地址，因此能够访问到64KB存储空间的任何单元。
例如：STAA  $3050;表示将累加器A中的内容，送入地址为$3050的单元中。
> -    相对寻址（Relative Addressing， REL）：相对寻址只出现在相对转移指令中。相对转移指令执行时事以当前的PC值加上指令中指定的地址偏移量relx，构成操作数的实际地址。这里所说的当前PC值是指相对转移指令的下一条指令的地址。偏移量分为：8位、9位和16位偏移量，均为带符号的二进制补码值，支持在存储器中向上或向下转移。采用负的偏移量值可以使PC指向操作码并开始循环。
> -    变址寻址（Indexed Addressing, IDX）:变址寻址是以某个寄存器的内容为基本地址，然后在这个基本地址上加上地址偏移量，形成操作数地址或存放操作数地址的地址，并将这个地址单元的内容作为指令的操作数。








🐔!
